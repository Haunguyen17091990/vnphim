!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).DMVAST=e()}}(function(){return function e(t,i,n){function r(o,a){if(!i[o]){if(!t[o]){var l="function"==typeof require&&require;if(!a&&l)return l(o,!0);if(s)return s(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var h=i[o]={exports:{}};t[o][0].call(h.exports,function(e){var i=t[o][1][e];return r(i||e)},h,h.exports,e,t,i,n)}return i[o].exports}for(var s="function"==typeof require&&require,o=0;o<n.length;o++)r(n[o]);return r}({1:[function(e,t,i){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function s(e){return"number"==typeof e}function o(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!s(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,i,n,s,l,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var h=new Error('Uncaught, unspecified "error" event. ('+t+")");throw h.context=t,h}if(i=this._events[e],a(i))return!1;if(r(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),i.apply(this,s)}else if(o(i))for(s=Array.prototype.slice.call(arguments,1),n=(u=i.slice()).length,l=0;l<n;l++)u[l].apply(this,s);return!0},n.prototype.addListener=function(e,t){var i;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(i=a(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&i>0&&this._events[e].length>i&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function i(){this.removeListener(e,i),n||(n=!0,t.apply(this,arguments))}if(!r(t))throw TypeError("listener must be a function");var n=!1;return i.listener=t,this.on(e,i),this},n.prototype.removeListener=function(e,t){var i,n,s,a;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(i=this._events[e],s=i.length,n=-1,i===t||r(i.listener)&&i.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(i)){for(a=s;a-- >0;)if(i[a]===t||i[a].listener&&i[a].listener===t){n=a;break}if(n<0)return this;1===i.length?(i.length=0,delete this._events[e]):i.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(i=this._events[e],r(i))this.removeListener(e,i);else if(i)for(;i.length;)this.removeListener(e,i[i.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},{}],2:[function(e,t,i){var n;n=function(){return function(){this.id=null,this.sequence=null,this.system=null,this.title=null,this.description=null,this.advertiser=null,this.pricing=null,this.survey=null,this.errorURLTemplates=[],this.impressionURLTemplates=[],this.creatives=[],this.extensions=[]}}(),t.exports=n},{}],3:[function(e,t,i){var n,r,s;r=e("./parser"),s=e("./util"),n=function(){function e(){}return e.cappingFreeLunch=0,e.cappingMinimumTimeInterval=0,e.options={withCredentials:!1,timeout:0},e.get=function(e,t,n){var s,o,a,l;if(o=+new Date,s=i.extend=function(e,t){var i,n;for(i in t)n=t[i],e[i]=n;return e},n||("function"==typeof t&&(n=t),a={}),a=s(this.options,t),this.totalCallsTimeout<o?(this.totalCalls=1,this.totalCallsTimeout=o+36e5):this.totalCalls++,!(this.cappingFreeLunch>=this.totalCalls)){if((l=o-this.lastSuccessfullAd)<0)this.lastSuccessfullAd=0;else if(l<this.cappingMinimumTimeInterval)return void n(null,new Error("VAST call canceled – ("+this.cappingMinimumTimeInterval+")ms minimum interval reached"));return r.parse(e,a,function(e,t){return n(e,t)})}n(null,new Error("VAST call canceled – FreeLunch capping not reached yet "+this.totalCalls+"/"+this.cappingFreeLunch))},function(){var t,i;i=s.storage,t=Object.defineProperty,["lastSuccessfullAd","totalCalls","totalCallsTimeout"].forEach(function(n){t(e,n,{get:function(){return i.getItem(n)},set:function(e){return i.setItem(n,e)},configurable:!1,enumerable:!0})}),null==e.lastSuccessfullAd&&(e.lastSuccessfullAd=0),null==e.totalCalls&&(e.totalCalls=0),null==e.totalCallsTimeout&&(e.totalCallsTimeout=0)}(),e}(),t.exports=n},{"./parser":12,"./util":18}],4:[function(e,t,i){var n;n=function(){return function(){this.id=null,this.width=0,this.height=0,this.type=null,this.staticResource=null,this.htmlResource=null,this.iframeResource=null,this.altText=null,this.companionClickThroughURLTemplate=null,this.companionClickTrackingURLTemplates=[],this.trackingEvents={}}}(),t.exports=n},{}],5:[function(e,t,i){var n,r,s,o,a=function(e,t){function i(){this.constructor=e}for(var n in t)l.call(t,n)&&(e[n]=t[n]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},l={}.hasOwnProperty;n=function(){return function(e){null==e&&(e={}),this.id=e.id||null,this.adId=e.adId||null,this.sequence=e.sequence||null,this.apiFramework=e.apiFramework||null,this.trackingEvents={}}}(),s=function(e){function t(){t.__super__.constructor.apply(this,arguments),this.type="linear",this.duration=0,this.skipDelay=null,this.mediaFiles=[],this.videoClickThroughURLTemplate=null,this.videoClickTrackingURLTemplates=[],this.videoCustomClickURLTemplates=[],this.adParameters=null,this.icons=[]}return a(t,n),t}(),o=function(e){function t(){t.__super__.constructor.apply(this,arguments),this.type="nonlinear",this.variations=[]}return a(t,n),t}(),r=function(e){function t(){t.__super__.constructor.apply(this,arguments),this.type="companion",this.variations=[]}return a(t,n),t}(),t.exports={VASTCreativeLinear:s,VASTCreativeNonLinear:o,VASTCreativeCompanion:r}},{}],6:[function(e,t,i){var n;n=function(){return function(){this.attributes={},this.children=[]}}(),t.exports=n},{}],7:[function(e,t,i){var n;n=function(){return function(){this.name=null,this.value=null,this.attributes={}}}(),t.exports=n},{}],8:[function(e,t,i){var n;n=function(){return function(){this.program=null,this.height=0,this.width=0,this.xPosition=0,this.yPosition=0,this.apiFramework=null,this.offset=null,this.duration=0,this.type=null,this.staticResource=null,this.htmlResource=null,this.iframeResource=null,this.iconClickThroughURLTemplate=null,this.iconClickTrackingURLTemplates=[],this.iconViewTrackingURLTemplate=null}}(),t.exports=n},{}],9:[function(e,t,i){t.exports={client:e("./client"),tracker:e("./tracker"),parser:e("./parser"),util:e("./util")}},{"./client":3,"./parser":12,"./tracker":14,"./util":18}],10:[function(e,t,i){var n;n=function(){return function(){this.id=null,this.fileURL=null,this.deliveryType="progressive",this.mimeType=null,this.codec=null,this.bitrate=0,this.minBitrate=0,this.maxBitrate=0,this.width=0,this.height=0,this.apiFramework=null,this.scalable=null,this.maintainAspectRatio=null}}(),t.exports=n},{}],11:[function(e,t,i){var n;n=function(){return function(){this.id=null,this.width=0,this.height=0,this.expandedWidth=0,this.expandedHeight=0,this.scalable=!0,this.maintainAspectRatio=!0,this.minSuggestedDuration=0,this.apiFramework="static",this.type=null,this.staticResource=null,this.htmlResource=null,this.iframeResource=null,this.nonlinearClickThroughURLTemplate=null,this.nonlinearClickTrackingURLTemplates=[],this.adParameters=null}}(),t.exports=n},{}],12:[function(e,t,i){var n,r,s,o,a,l,u,h,c,p,d,f,m,g,v,T=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};r=e("./urlhandler"),g=e("./response"),s=e("./ad"),o=e("./extension"),a=e("./extensionchild"),v=e("./util"),h=e("./creative").VASTCreativeLinear,u=e("./creative").VASTCreativeCompanion,c=e("./creative").VASTCreativeNonLinear,d=e("./mediafile"),p=e("./icon"),l=e("./companionad"),f=e("./nonlinear"),n=e("events").EventEmitter,m=function(){function e(){}var t;return t=[],e.addURLTemplateFilter=function(e){"function"==typeof e&&t.push(e)},e.removeURLTemplateFilter=function(){return t.pop()},e.countURLTemplateFilters=function(){return t.length},e.clearUrlTemplateFilters=function(){return t=[]},e.parse=function(e,t,i){return i||("function"==typeof t&&(i=t),t={}),this._parse(e,null,t,function(e,t){return i(t,e)})},e.vent=new n,e.track=function(e,t){return this.vent.emit("VAST-error",t),v.track(e,t)},e.on=function(e,t){return this.vent.on(e,t)},e.once=function(e,t){return this.vent.once(e,t)},e._parse=function(e,i,n,s){var o,a,l;for(s||("function"==typeof n&&(s=n),n={}),a=0,l=t.length;a<l;a++)o=t[a],e=o(e);return null==i&&(i=[]),i.push(e),r.get(e,n,function(t){return function(r,o){var a,l,u,h,c,p,d,f,m,v,k;if(null!=r)return s(r);if(k=new g,null==(null!=o?o.documentElement:void 0)||"VAST"!==o.documentElement.nodeName)return s(new Error("Invalid VAST XMLDocument"));for(u=0,c=(m=o.documentElement.childNodes).length;u<c;u++)"Error"===(f=m[u]).nodeName&&k.errorURLTemplates.push(t.parseNodeText(f));for(h=0,p=(v=o.documentElement.childNodes).length;h<p;h++)"Ad"===(f=v[h]).nodeName&&(null!=(a=t.parseAdElement(f))?k.ads.push(a):t.track(k.errorURLTemplates,{ERRORCODE:101}));for(l=function(e,i){var n,r,o,l;if(null==e&&(e=null),null==i&&(i=!1),k){for(o=!0,n=0,r=(l=k.ads).length;n<r;n++){if(null!=(a=l[n]).nextWrapperURL)return;a.creatives.length>0&&(o=!1)}return o&&(i||t.track(k.errorURLTemplates,{ERRORCODE:303})),0===k.ads.length&&(k=null),s(e,k)}},d=k.ads.length;d--;)null!=(a=k.ads[d]).nextWrapperURL&&function(r){var s,o,a;i.length>(null!==n.wrapperLimit?n.wrapperLimit:9)||(a=r.nextWrapperURL,T.call(i,a)>=0)?(t.track(r.errorURLTemplates,{ERRORCODE:302}),k.ads.splice(k.ads.indexOf(r),1),l(new Error("Wrapper limit reached, as defined by the video player"))):(0===r.nextWrapperURL.indexOf("//")?(o=location.protocol,r.nextWrapperURL=""+o+r.nextWrapperURL):-1===r.nextWrapperURL.indexOf("://")&&(s=e.slice(0,e.lastIndexOf("/")),r.nextWrapperURL=s+"/"+r.nextWrapperURL),t._parse(r.nextWrapperURL,i,n,function(e,i){var n,s,o,a,u,h,c,p,d,f,m,g,v,T,y,R,L,x,N,C,A,U,w,b;if(o=!1,null!=e)t.track(r.errorURLTemplates,{ERRORCODE:301}),k.ads.splice(k.ads.indexOf(r),1),o=!0;else if(null==i)t.track(r.errorURLTemplates,{ERRORCODE:303}),k.ads.splice(k.ads.indexOf(r),1),o=!0;else for(k.errorURLTemplates=k.errorURLTemplates.concat(i.errorURLTemplates),u=k.ads.indexOf(r),k.ads.splice(u,1),h=0,c=(x=i.ads).length;h<c;h++){if(b=x[h],b.errorURLTemplates=r.errorURLTemplates.concat(b.errorURLTemplates),b.impressionURLTemplates=r.impressionURLTemplates.concat(b.impressionURLTemplates),b.extensions=r.extensions.concat(b.extensions),null!=r.trackingEvents)for(v=0,p=(N=b.creatives).length;v<p;v++)if(s=N[v],null!=r.trackingEvents[s.type])for(T=0,d=(C=Object.keys(r.trackingEvents[s.type])).length;T<d;T++)a=C[T],(n=s.trackingEvents)[a]||(n[a]=[]),s.trackingEvents[a]=s.trackingEvents[a].concat(r.trackingEvents[s.type][a]);if(null!=r.videoClickTrackingURLTemplates)for(y=0,f=(A=b.creatives).length;y<f;y++)"linear"===(s=A[y]).type&&(s.videoClickTrackingURLTemplates=s.videoClickTrackingURLTemplates.concat(r.videoClickTrackingURLTemplates));if(null!=r.videoCustomClickURLTemplates)for(R=0,m=(U=b.creatives).length;R<m;R++)"linear"===(s=U[R]).type&&(s.videoCustomClickURLTemplates=s.videoCustomClickURLTemplates.concat(r.videoCustomClickURLTemplates));if(null!=r.videoClickThroughURLTemplate)for(L=0,g=(w=b.creatives).length;L<g;L++)"linear"===(s=w[L]).type&&null==s.videoClickThroughURLTemplate&&(s.videoClickThroughURLTemplate=r.videoClickThroughURLTemplate);k.ads.splice(++u,0,b)}return delete r.nextWrapperURL,l(e,o)}))}(a);return l()}}(this))},e.childByName=function(e,t){var i,n,r,s;for(n=0,r=(s=e.childNodes).length;n<r;n++)if((i=s[n]).nodeName===t)return i},e.childsByName=function(e,t){var i,n,r,s,o;for(n=[],r=0,s=(o=e.childNodes).length;r<s;r++)(i=o[r]).nodeName===t&&n.push(i);return n},e.parseAdElement=function(e){var t,i,n,r,s;for(i=0,n=(r=e.childNodes).length;i<n;i++)if(t=r[i],"Wrapper"===(s=t.nodeName)||"InLine"===s){if(this.copyNodeAttribute("id",e,t),this.copyNodeAttribute("sequence",e,t),"Wrapper"===t.nodeName)return this.parseWrapperElement(t);if("InLine"===t.nodeName)return this.parseInLineElement(t)}},e.parseWrapperElement=function(e){var t,i,n,r,s,o,a;for(t=this.parseInLineElement(e),null!=(a=this.childByName(e,"VASTAdTagURI"))?t.nextWrapperURL=this.parseNodeText(a):null!=(a=this.childByName(e,"VASTAdTagURL"))&&(t.nextWrapperURL=this.parseNodeText(this.childByName(a,"URL"))),n=0,r=(s=t.creatives).length;n<r;n++)o=null,"linear"!==(i=s[n]).type&&"nonlinear"!==i.type||null!=(o=i)&&(null!=o.trackingEvents&&(t.trackingEvents||(t.trackingEvents={}),t.trackingEvents[o.type]=o.trackingEvents),null!=o.videoClickTrackingURLTemplates&&(t.videoClickTrackingURLTemplates=o.videoClickTrackingURLTemplates),null!=o.videoClickThroughURLTemplate&&(t.videoClickThroughURLTemplate=o.videoClickThroughURLTemplate),null!=o.videoCustomClickURLTemplates&&(t.videoCustomClickURLTemplates=o.videoCustomClickURLTemplates));if(null!=t.nextWrapperURL)return t},e.parseInLineElement=function(e){var t,i,n,r,o,a,l,u,h,c,p,d,f,m,g;for((t=new s).id=e.getAttribute("id")||null,t.sequence=e.getAttribute("sequence")||null,a=0,h=(f=e.childNodes).length;a<h;a++)switch((d=f[a]).nodeName){case"Error":t.errorURLTemplates.push(this.parseNodeText(d));break;case"Impression":t.impressionURLTemplates.push(this.parseNodeText(d));break;case"Creatives":for(l=0,c=(m=this.childsByName(d,"Creative")).length;l<c;l++)for(n={id:(r=m[l]).getAttribute("id")||null,adId:this.parseCreativeAdIdAttribute(r),sequence:r.getAttribute("sequence")||null,apiFramework:r.getAttribute("apiFramework")||null},u=0,p=(g=r.childNodes).length;u<p;u++)switch((o=g[u]).nodeName){case"Linear":(i=this.parseCreativeLinearElement(o,n))&&t.creatives.push(i);break;case"NonLinearAds":(i=this.parseNonLinear(o,n))&&t.creatives.push(i);break;case"CompanionAds":(i=this.parseCompanionAd(o,n))&&t.creatives.push(i)}break;case"Extensions":this.parseExtension(t.extensions,this.childsByName(d,"Extension"));break;case"AdSystem":t.system={value:this.parseNodeText(d),version:d.getAttribute("version")||null};break;case"AdTitle":t.title=this.parseNodeText(d);break;case"Description":t.description=this.parseNodeText(d);break;case"Advertiser":t.advertiser=this.parseNodeText(d);break;case"Pricing":t.pricing={value:this.parseNodeText(d),model:d.getAttribute("model")||null,currency:d.getAttribute("currency")||null};break;case"Survey":t.survey=this.parseNodeText(d)}return t},e.parseExtension=function(e,t){var i,n,r,s,l,u,h,c,p,d,f,m,g,v,T,k,y,R,L;for(R=[],h=0,f=t.length;h<f;h++){if(l=t[h],n=new o,l.attributes)for(c=0,m=(T=l.attributes).length;c<m;c++)u=T[c],n.attributes[u.nodeName]=u.nodeValue;for(p=0,g=(k=l.childNodes).length;p<g;p++)if(i=k[p],L=this.parseNodeText(i),"#comment"!==i.nodeName&&""!==L){if(r=new a,r.name=i.nodeName,r.value=L,i.attributes)for(d=0,v=(y=i.attributes).length;d<v;d++)s=y[d],r.attributes[s.nodeName]=s.nodeValue;n.children.push(r)}R.push(e.push(n))}return R},e.parseCreativeLinearElement=function(e,t){var i,n,r,s,o,a,l,u,c,f,m,g,v,T,k,y,R,L,x,N,C,A,U,w,b,E,_,I,D,B,S,O,F,M,P,H,V,W,q,X,j,Y,G,Q,$,z,J,K,Z,ee,te,ie,ne,re,se,oe,ae,le,ue;if(s=new h(t),s.duration=this.parseDuration(this.parseNodeText(this.childByName(e,"Duration"))),-1===s.duration&&"Wrapper"!==e.parentNode.parentNode.parentNode.nodeName)return null;if(null==(re=e.getAttribute("skipoffset"))?s.skipDelay=null:"%"===re.charAt(re.length-1)?(W=parseInt(re,10),s.skipDelay=s.duration*(W/100)):s.skipDelay=this.parseDuration(re),null!=(ue=this.childByName(e,"VideoClicks"))){for(s.videoClickThroughURLTemplate=this.parseNodeText(this.childByName(ue,"ClickThrough")),u=0,L=(j=this.childsByName(ue,"ClickTracking")).length;u<L;u++)r=j[u],s.videoClickTrackingURLTemplates.push(this.parseNodeText(r));for(k=0,x=(Y=this.childsByName(ue,"CustomClick")).length;k<x;k++)o=Y[k],s.videoCustomClickURLTemplates.push(this.parseNodeText(o))}for(null!=(i=this.childByName(e,"AdParameters"))&&(s.adParameters=this.parseNodeText(i)),y=0,C=(Q=this.childsByName(e,"TrackingEvents")).length;y<C;y++)for(ae=Q[y],R=0,A=($=this.childsByName(ae,"Tracking")).length;R<A;R++)if(oe=$[R],a=oe.getAttribute("event"),le=this.parseNodeText(oe),null!=a&&null!=le){if("progress"===a){if(!(H=oe.getAttribute("offset")))continue;a="%"===H.charAt(H.length-1)?"progress-"+H:"progress-"+Math.round(this.parseDuration(H))}null==(n=s.trackingEvents)[a]&&(n[a]=[]),s.trackingEvents[a].push(le)}for(D=0,U=(z=this.childsByName(e,"MediaFiles")).length;D<U;D++)for(F=z[D],M=0,w=(J=this.childsByName(F,"MediaFile")).length;M<w;M++)O=J[M],(S=new d).id=O.getAttribute("id"),S.fileURL=this.parseNodeText(O),S.deliveryType=O.getAttribute("delivery"),S.codec=O.getAttribute("codec"),S.mimeType=O.getAttribute("type"),S.apiFramework=O.getAttribute("apiFramework"),S.bitrate=parseInt(O.getAttribute("bitrate")||0),S.minBitrate=parseInt(O.getAttribute("minBitrate")||0),S.maxBitrate=parseInt(O.getAttribute("maxBitrate")||0),S.width=parseInt(O.getAttribute("width")||0),S.height=parseInt(O.getAttribute("height")||0),(ne=O.getAttribute("scalable"))&&"string"==typeof ne&&("true"===(ne=ne.toLowerCase())?S.scalable=!0:"false"===ne&&(S.scalable=!1)),(B=O.getAttribute("maintainAspectRatio"))&&"string"==typeof B&&("true"===(B=B.toLowerCase())?S.maintainAspectRatio=!0:"false"===B&&(S.maintainAspectRatio=!1)),s.mediaFiles.push(S);if(null!=(v=this.childByName(e,"Icons")))for(P=0,b=(K=this.childsByName(v,"Icon")).length;P<b;P++){for(g=K[P],(c=new p).program=g.getAttribute("program"),c.height=parseInt(g.getAttribute("height")||0),c.width=parseInt(g.getAttribute("width")||0),c.xPosition=this.parseXPosition(g.getAttribute("xPosition")),c.yPosition=this.parseYPosition(g.getAttribute("yPosition")),c.apiFramework=g.getAttribute("apiFramework"),c.offset=this.parseDuration(g.getAttribute("offset")),c.duration=this.parseDuration(g.getAttribute("duration")),V=0,E=(Z=this.childsByName(g,"HTMLResource")).length;V<E;V++)l=Z[V],c.type=l.getAttribute("creativeType")||"text/html",c.htmlResource=this.parseNodeText(l);for(q=0,_=(ee=this.childsByName(g,"IFrameResource")).length;q<_;q++)T=ee[q],c.type=T.getAttribute("creativeType")||0,c.iframeResource=this.parseNodeText(T);for(X=0,I=(te=this.childsByName(g,"StaticResource")).length;X<I;X++)se=te[X],c.type=se.getAttribute("creativeType")||0,c.staticResource=this.parseNodeText(se);if(null!=(m=this.childByName(g,"IconClicks")))for(c.iconClickThroughURLTemplate=this.parseNodeText(this.childByName(m,"IconClickThrough")),ie=0,N=(G=this.childsByName(m,"IconClickTracking")).length;ie<N;ie++)f=G[ie],c.iconClickTrackingURLTemplates.push(this.parseNodeText(f));c.iconViewTrackingURLTemplate=this.parseNodeText(this.childByName(g,"IconViewTracking")),s.icons.push(c)}return s},e.parseNonLinear=function(e,t){var i,n,r,s,o,a,l,u,h,p,d,m,g,v,T,k,y,R,L,x,N,C,A,U,w,b,E,_,I,D,B,S,O,F;for(s=new c(t),l=0,m=(U=this.childsByName(e,"TrackingEvents")).length;l<m;l++)for(O=U[l],h=0,g=(w=this.childsByName(O,"Tracking")).length;h<g;h++)o=(S=w[h]).getAttribute("event"),F=this.parseNodeText(S),null!=o&&null!=F&&(null==(n=s.trackingEvents)[o]&&(n[o]=[]),s.trackingEvents[o].push(F));for(p=0,v=(b=this.childsByName(e,"NonLinear")).length;p<v;p++){for(C=b[p],(N=new f).id=C.getAttribute("id")||null,N.width=C.getAttribute("width"),N.height=C.getAttribute("height"),N.expandedWidth=C.getAttribute("expandedWidth"),N.expandedHeight=C.getAttribute("expandedHeight"),N.scalable=this.parseBoolean(C.getAttribute("scalable")),N.maintainAspectRatio=this.parseBoolean(C.getAttribute("maintainAspectRatio")),N.minSuggestedDuration=this.parseDuration(C.getAttribute("minSuggestedDuration")),N.apiFramework=C.getAttribute("apiFramework"),d=0,T=(E=this.childsByName(C,"HTMLResource")).length;d<T;d++)a=E[d],N.type=a.getAttribute("creativeType")||"text/html",N.htmlResource=this.parseNodeText(a);for(L=0,k=(_=this.childsByName(C,"IFrameResource")).length;L<k;L++)u=_[L],N.type=u.getAttribute("creativeType")||0,N.iframeResource=this.parseNodeText(u);for(x=0,y=(I=this.childsByName(C,"StaticResource")).length;x<y;x++)B=I[x],N.type=B.getAttribute("creativeType")||0,N.staticResource=this.parseNodeText(B);for(null!=(i=this.childByName(C,"AdParameters"))&&(N.adParameters=this.parseNodeText(i)),N.nonlinearClickThroughURLTemplate=this.parseNodeText(this.childByName(C,"NonLinearClickThrough")),A=0,R=(D=this.childsByName(C,"NonLinearClickTracking")).length;A<R;A++)r=D[A],N.nonlinearClickTrackingURLTemplates.push(this.parseNodeText(r));s.variations.push(N)}return s},e.parseCompanionAd=function(e,t){var i,n,r,s,o,a,h,c,p,d,f,m,g,v,T,k,y,R,L,x,N,C,A,U,w,b,E,_,I,D,B,S,O,F,M,P,H;for(a=new u(t),p=0,v=(b=this.childsByName(e,"Companion")).length;p<v;p++){for(o=b[p],(s=new l).id=o.getAttribute("id")||null,s.width=o.getAttribute("width"),s.height=o.getAttribute("height"),s.companionClickTrackingURLTemplates=[],f=0,T=(E=this.childsByName(o,"HTMLResource")).length;f<T;f++)c=E[f],s.type=c.getAttribute("creativeType")||"text/html",s.htmlResource=this.parseNodeText(c);for(m=0,k=(_=this.childsByName(o,"IFrameResource")).length;m<k;m++)d=_[m],s.type=d.getAttribute("creativeType")||0,s.iframeResource=this.parseNodeText(d);for(g=0,y=(I=this.childsByName(o,"StaticResource")).length;g<y;g++){for(F=I[g],s.type=F.getAttribute("creativeType")||0,C=0,R=(D=this.childsByName(o,"AltText")).length;C<R;C++)n=D[C],s.altText=this.parseNodeText(n);s.staticResource=this.parseNodeText(F)}for(A=0,L=(B=this.childsByName(o,"TrackingEvents")).length;A<L;A++)for(P=B[A],U=0,x=(S=this.childsByName(P,"Tracking")).length;U<x;U++)h=(M=S[U]).getAttribute("event"),H=this.parseNodeText(M),null!=h&&null!=H&&(null==(i=s.trackingEvents)[h]&&(i[h]=[]),s.trackingEvents[h].push(H));for(w=0,N=(O=this.childsByName(o,"CompanionClickTracking")).length;w<N;w++)r=O[w],s.companionClickTrackingURLTemplates.push(this.parseNodeText(r));s.companionClickThroughURLTemplate=this.parseNodeText(this.childByName(o,"CompanionClickThrough")),s.companionClickTrackingURLTemplate=this.parseNodeText(this.childByName(o,"CompanionClickTracking")),a.variations.push(s)}return a},e.parseDuration=function(e){var t,i,n,r,s;return null==e?-1:v.isNumeric(e)?parseInt(e):3!==(t=e.split(":")).length?-1:(s=t[2].split("."),r=parseInt(s[0]),2===s.length&&(r+=parseFloat("0."+s[1])),n=parseInt(60*t[1]),i=parseInt(60*t[0]*60),isNaN(i||isNaN(n||isNaN(r||n>3600||r>60)))?-1:i+n+r)},e.parseXPosition=function(e){return"left"===e||"right"===e?e:parseInt(e||0)},e.parseYPosition=function(e){return"top"===e||"bottom"===e?e:parseInt(e||0)},e.parseBoolean=function(e){return"true"===e||"TRUE"===e||"1"===e},e.parseNodeText=function(e){return e&&(e.textContent||e.text||"").trim()},e.copyNodeAttribute=function(e,t,i){var n;if(n=t.getAttribute(e))return i.setAttribute(e,n)},e.parseCreativeAdIdAttribute=function(e){return e.getAttribute("AdID")||e.getAttribute("adID")||e.getAttribute("adId")||null},e}(),t.exports=m},{"./ad":2,"./companionad":4,"./creative":5,"./extension":6,"./extensionchild":7,"./icon":8,"./mediafile":10,"./nonlinear":11,"./response":13,"./urlhandler":15,"./util":18,events:1}],13:[function(e,t,i){var n;n=function(){return function(){this.ads=[],this.errorURLTemplates=[]}}(),t.exports=n},{}],14:[function(e,t,i){var n,r,s,o,a,l,u,h=function(e,t){function i(){this.constructor=e}for(var n in t)c.call(t,n)&&(e[n]=t[n]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},c={}.hasOwnProperty;r=e("./client"),u=e("./util"),o=e("./creative").VASTCreativeLinear,a=e("./nonlinear"),s=e("./companionad"),n=e("events").EventEmitter,l=function(e){function t(e,t,i){var n,l,u;this.ad=e,this.creative=t,this.variation=null!=i?i:null,this.muted=!1,this.impressed=!1,this.skipable=!1,this.skipDelayDefault=-1,this.trackingEvents={},this.emitAlwaysEvents=["creativeView","start","firstQuartile","midpoint","thirdQuartile","complete","resume","pause","rewind","skip","closeLinear","close"],u=this.creative.trackingEvents;for(n in u)l=u[n],this.trackingEvents[n]=l.slice(0);this.creative instanceof o?(this.setDuration(this.creative.duration),this.skipDelay=this.creative.skipDelay,this.linear=!0,this.clickThroughURLTemplate=this.creative.videoClickThroughURLTemplate,this.clickTrackingURLTemplates=this.creative.videoClickTrackingURLTemplates):(this.skipDelay=-1,this.linear=!1,this.variation&&(this.variation instanceof a?(this.clickThroughURLTemplate=this.variation.nonlinearClickThroughURLTemplate,this.clickTrackingURLTemplates=this.variation.nonlinearClickTrackingURLTemplates):this.variation instanceof s&&(this.clickThroughURLTemplate=this.variation.companionClickThroughURLTemplate,this.clickTrackingURLTemplates=this.variation.companionClickTrackingURLTemplates))),this.on("start",function(){r.lastSuccessfullAd=+new Date})}return h(t,n),t.prototype.setDuration=function(e){return this.assetDuration=e,this.quartiles={firstQuartile:Math.round(25*this.assetDuration)/100,midpoint:Math.round(50*this.assetDuration)/100,thirdQuartile:Math.round(75*this.assetDuration)/100}},t.prototype.setProgress=function(e){var t,i,n,r,s,o,a,l,u;if(-1===(l=null===this.skipDelay?this.skipDelayDefault:this.skipDelay)||this.skipable||(l>e?this.emit("skip-countdown",l-e):(this.skipable=!0,this.emit("skip-countdown",0))),this.linear&&this.assetDuration>0){if(i=[],e>0){i.push("start"),s=Math.round(e/this.assetDuration*100),i.push("progress-"+s+"%"),i.push("progress-"+Math.round(e)),a=this.quartiles;for(o in a)(u=a[o])<=e&&e<=u+1&&i.push(o)}for(n=0,r=i.length;n<r;n++)t=i[n],this.track(t,!0);e<this.progress&&this.track("rewind")}return this.progress=e},t.prototype.setMuted=function(e){return this.muted!==e&&this.track(e?"mute":"unmute"),this.muted=e},t.prototype.setPaused=function(e){return this.paused!==e&&this.track(e?"pause":"resume"),this.paused=e},t.prototype.setFullscreen=function(e){return this.fullscreen!==e&&this.track(e?"fullscreen":"exitFullscreen"),this.fullscreen=e},t.prototype.setExpand=function(e){return this.expanded!==e&&this.track(e?"expand":"collapse"),this.expanded=e},t.prototype.setSkipDelay=function(e){if("number"==typeof e)return this.skipDelay=e},t.prototype.load=function(){if(!this.impressed)return this.impressed=!0,this.trackURLs(this.ad.impressionURLTemplates),this.track("creativeView")},t.prototype.errorWithCode=function(e){return this.trackURLs(this.ad.errorURLTemplates,{ERRORCODE:e})},t.prototype.complete=function(){return this.track("complete")},t.prototype.close=function(){return this.track(this.linear?"closeLinear":"close")},t.prototype.stop=function(){},t.prototype.skip=function(){return this.track("skip"),this.trackingEvents=[]},t.prototype.click=function(){var e,t,i;if((null!=(t=this.clickTrackingURLTemplates)?t.length:void 0)&&this.trackURLs(this.clickTrackingURLTemplates),null!=this.clickThroughURLTemplate)return console.log("clickThroughURLTemplate"),console.log(this.clickThroughURLTemplate),this.linear&&(i={CONTENTPLAYHEAD:this.progressFormated()}),e=u.resolveURLTemplates([this.clickThroughURLTemplate],i)[0],this.emit("clickthrough",e)},t.prototype.track=function(e,t){var i,n;console.log(e),null==t&&(t=!1),"closeLinear"===e&&null==this.trackingEvents[e]&&null!=this.trackingEvents.close&&(e="close"),n=this.trackingEvents[e],i=this.emitAlwaysEvents.indexOf(e),null!=n?(this.emit(e,""),this.trackURLs(n)):-1!==i&&this.emit(e,""),!0===t&&(delete this.trackingEvents[e],i>-1&&this.emitAlwaysEvents.splice(i,1))},t.prototype.trackURLs=function(e,t){var i;return null==t&&(t={}),this.linear&&(null!=(null!=(i=this.creative.mediaFiles[0])?i.fileURL:void 0)&&(t.ASSETURI=this.creative.mediaFiles[0].fileURL),t.CONTENTPLAYHEAD=this.progressFormated()),console.log(e),u.track(e,t)},t.prototype.progressFormated=function(){var e,t,i,n,r;return r=parseInt(this.progress),(e=r/3600).length<2&&(e="0"+e),(t=r/60%60).length<2&&(t="0"+t),(n=r%60).length<2&&(n="0"+t),i=parseInt(100*(this.progress-r)),e+":"+t+":"+n+"."+i},t}(),t.exports=l},{"./client":3,"./companionad":4,"./creative":5,"./nonlinear":11,"./util":18,events:1}],15:[function(e,t,i){var n,r,s;s=e("./urlhandlers/xmlhttprequest"),r=e("./urlhandlers/flash"),n=function(){function t(){}return t.get=function(t,i,n){var o,a;return n||("function"==typeof i&&(n=i),i={}),null!=i.response?(a=i.response,delete i.response,n(null,a)):(null!=(o=i.urlhandler)?o.supported():void 0)?i.urlhandler.get(t,i,n):"undefined"==typeof window||null===window?e("./urlhandlers/node").get(t,i,n):s.supported()?s.get(t,i,n):r.supported()?r.get(t,i,n):n(new Error("Current context is not supported by any of the default URLHandlers. Please provide a custom URLHandler"))},t}(),t.exports=n},{"./urlhandlers/flash":16,"./urlhandlers/xmlhttprequest":17}],16:[function(e,t,i){var n;n=function(){function e(){}return e.xdr=function(){var e;return window.XDomainRequest&&(e=new XDomainRequest),e},e.supported=function(){return!!this.xdr()},e.get=function(e,t,i){var n,r;return(r="function"==typeof window.ActiveXObject?new window.ActiveXObject("Microsoft.XMLDOM"):void 0)?(r.async=!1,(n=this.xdr()).open("GET",e),n.timeout=t.timeout||0,n.withCredentials=t.withCredentials||!1,n.send(),n.onprogress=function(){},n.onload=function(){return r.loadXML(n.responseText),i(null,r)}):i(new Error("FlashURLHandler: Microsoft.XMLDOM format not supported"))},e}(),t.exports=n},{}],17:[function(e,t,i){var n;n=function(){function e(){}return e.xhr=function(){var e;if("withCredentials"in(e=new window.XMLHttpRequest))return e},e.supported=function(){return!!this.xhr()},e.get=function(e,t,i){var n;if("https:"===window.location.protocol&&0===e.indexOf("http://"))return i(new Error("XHRURLHandler: Cannot go from HTTPS to HTTP."));try{return(n=this.xhr()).open("GET",e),n.timeout=t.timeout||0,n.withCredentials=t.withCredentials||!1,n.overrideMimeType&&n.overrideMimeType("text/xml"),n.onreadystatechange=function(){if(4===n.readyState)return 200===n.status?i(null,n.responseXML):i(new Error("XHRURLHandler: "+n.statusText))},n.send()}catch(e){return i(new Error("XHRURLHandler: Unexpected error"))}},e}(),t.exports=n},{}],18:[function(e,t,i){var n;n=function(){function e(){}return e.track=function(e,t){var i,n,r,s,o,a;for(a=[],s=0,o=(n=this.resolveURLTemplates(e,t)).length;s<o;s++)i=n[s],"undefined"!=typeof window&&null!==window&&(r=new Image,a.push(r.src=i));return a},e.resolveURLTemplates=function(e,t){var i,n,r,s,o,a,l,u,h;for(null==t&&(t={}),n=[],null!=t.ASSETURI&&(t.ASSETURI=this.encodeURIComponentRFC3986(t.ASSETURI)),null!=t.CONTENTPLAYHEAD&&(t.CONTENTPLAYHEAD=this.encodeURIComponentRFC3986(t.CONTENTPLAYHEAD)),null==t.ERRORCODE||/^[0-9]{3}$/.test(t.ERRORCODE)||(t.ERRORCODE=900),t.CACHEBUSTING=this.leftpad(Math.round(1e8*Math.random()).toString()),t.TIMESTAMP=this.encodeURIComponentRFC3986((new Date).toISOString()),t.RANDOM=t.random=t.CACHEBUSTING,r=0,o=e.length;r<o;r++)if(i=e[r],u=i){for(s in t)h=t[s],a="["+s+"]",l="%%"+s+"%%",u=(u=u.replace(a,h)).replace(l,h);n.push(u)}return n},e.encodeURIComponentRFC3986=function(e){return encodeURIComponent(e).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16)})},e.leftpad=function(e){return e.length<8?function(){var t,i,n;for(n=[],t=0,i=8-e.length;0<=i?t<i:t>i;0<=i?t++:t--)n.push("0");return n}().join("")+e:e},e.storage=function(){var e,t,i;try{i="undefined"!=typeof window&&null!==window?window.localStorage||window.sessionStorage:null}catch(e){e,i=null}return t=function(e){var t;try{if(t="__VASTUtil__",e.setItem(t,t),e.getItem(t)!==t)return!0}catch(e){return e,!0}return!1},(null==i||t(i))&&(e={},i={length:0,getItem:function(t){return e[t]},setItem:function(t,i){e[t]=i,this.length=Object.keys(e).length},removeItem:function(t){delete e[t],this.length=Object.keys(e).length},clear:function(){e={},this.length=0}}),i}(),e.isNumeric=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},e}(),t.exports=n},{}]},{},[9])(9)});
!function t(e,i,n){function o(s,c){if(!i[s]){if(!e[s]){var a="function"==typeof require&&require;if(!c&&a)return a(s,!0);if(r)return r(s,!0);var d=new Error("Cannot find module '"+s+"'");throw d.code="MODULE_NOT_FOUND",d}var u=i[s]={exports:{}};e[s][0].call(u.exports,function(t){var i=e[s][1][t];return o(i||t)},u,u.exports,t,e,i,n)}return i[s].exports}for(var r="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(t,e,i){"use strict";function n(t,e,i){}function o(t,e,i){Object.defineProperty(t,e,{writable:!1,configurable:!1,value:i})}var r=["handshakeVersion","initAd","startAd","stopAd","skipAd","resizeAd","pauseAd","resumeAd","expandAd","collapseAd","subscribe","unsubscribe"],s=["AdLoaded","AdStarted","AdStopped","AdSkipped","AdSkippableStateChange","AdSizeChange","AdLinearChange","AdDurationChange","AdExpandedChange","AdRemainingTimeChange","AdVolumeChange","AdImpression","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete","AdClickThru","AdInteraction","AdUserAcceptInvitation","AdUserMinimize","AdUserClose","AdPaused","AdPlaying","AdLog","AdError"],c=["getAdLinear","getAdWidth","getAdHeight","getAdExpanded","getAdSkippableState","getAdRemainingTime","getAdDuration","getAdVolume","getAdCompanions","getAdIcons"],a=["setAdVolume"];n.prototype.handshakeVersion=function(t,e){},n.prototype.initAd=function(t,e,i,n,o,r,s){},n.prototype.startAd=function(t){},n.prototype.stopAd=function(t){},n.prototype.skipAd=function(t){},n.prototype.resizeAd=function(t,e,i,n){},n.prototype.pauseAd=function(t){},n.prototype.resumeAd=function(t){},n.prototype.expandAd=function(t){},n.prototype.collapseAd=function(t){},n.prototype.subscribe=function(t,e,i){},n.prototype.unsubscribe=function(t,e){},n.prototype.getAdLinear=function(t){},n.prototype.getAdWidth=function(t){},n.prototype.getAdHeight=function(t){},n.prototype.getAdExpanded=function(t){},n.prototype.getAdSkippableState=function(t){},n.prototype.getAdRemainingTime=function(t){},n.prototype.getAdDuration=function(t){},n.prototype.getAdVolume=function(t){},n.prototype.getAdCompanions=function(t){},n.prototype.getAdIcons=function(t){},n.prototype.setAdVolume=function(t,e){},o(n,"METHODS",r),o(n,"GETTERS",c),o(n,"SETTERS",a),o(n,"EVENTS",s);var d=r.filter(function(t){return-1===["skipAd"].indexOf(t)});o(n,"checkVPAIDInterface",function(t){return d.every(function(e){return"function"==typeof t[e]})}),e.exports=n},{}],2:[function(t,e,i){"use strict";function n(t,e,i,n){this._isValid=u(t),this._isValid&&(this._creative=t,this._el=e,this._videoEl=i,this._iframe=n,this._subscribers=new d,p.setFullSizeStyle(e),o.call(this))}function o(){if(h.forEach(function(t){this._creative.subscribe(s.bind(this,t),t)}.bind(this)),this._creative.subscribe(r.bind(this),f),this._videoEl){var t=this._iframe.contentDocument.documentElement,e=this._videoEl;t.addEventListener("click",function(i){i.target===t&&e.click()})}}function r(t,e,i){this._subscribers.triggerSync(f,{url:t,id:e,playerHandles:i})}function s(t){this._subscribers.trigger(t,Array.prototype.slice(arguments,1))}function c(t,e,i,n){t?t(i,n):i&&e.trigger(l,i)}var a=t("./IVPAIDAdUnit"),d=t("./subscriber"),u=a.checkVPAIDInterface,p=t("./utils"),l=(a.METHODS,"AdError"),f="AdClickThru",h=a.EVENTS.filter(function(t){return t!=f});(n.prototype=Object.create(a.prototype)).isValidVPAIDAd=function(){return this._isValid},a.METHODS.forEach(function(t){-1===["subscribe","unsubscribe","initAd"].indexOf(t)&&(n.prototype[t]=function(){var e=a.prototype[t].length,i=Array.prototype.slice.call(arguments),n=e===i.length?i.pop():void 0;setTimeout(function(){var e,o=null;try{e=this._creative[t].apply(this._creative,i)}catch(t){o=t}c(n,this._subscribers,o,e)}.bind(this),0)})}),n.prototype.initAd=function(t,e,i,n,o,r,s){o=o||{},r=p.extend({slot:this._el,videoSlot:this._videoEl},r||{}),setTimeout(function(){var a;try{this._creative.initAd(t,e,i,n,o,r)}catch(t){a=t}c(s,this._subscribers,a)}.bind(this),0)},n.prototype.subscribe=function(t,e,i){this._subscribers.subscribe(e,t,i)},n.prototype.unsubscribe=function(t,e){this._subscribers.unsubscribe(e,t)},n.prototype.on=n.prototype.subscribe,n.prototype.off=n.prototype.unsubscribe,a.GETTERS.forEach(function(t){n.prototype[t]=function(e){setTimeout(function(){var i,n=null;try{i=this._creative[t]()}catch(t){n=t}c(e,this._subscribers,n,i)}.bind(this),0)}}),n.prototype.setAdVolume=function(t,e){setTimeout(function(){var i,n=null;try{this._creative.setAdVolume(t),i=this._creative.getAdVolume()}catch(t){n=t}n||(n=p.validate(i===t,"failed to apply volume: "+t)),c(e,this._subscribers,n,i)}.bind(this),0)},n.prototype._destroy=function(){this.stopAd(),this._subscribers.unsubscribeAll()},e.exports=n},{"./IVPAIDAdUnit":1,"./subscriber":4,"./utils":5}],3:[function(t,e,i){"use strict";function n(t,e,i,n){i=i||{},this._id=f(),this._destroyed=!1;try{var o=document.querySelector(".bsplayer-vpaid");o&&o.parentNode.removeChild(o)}catch(t){}this._frameContainer=l.createElementInEl(t,"div"),this._frameContainer.className="bsplayer-vpaid",this._videoEl=e,this._vpaidOptions=n||{timeout:1e4},this._templateConfig={template:i.template||y,extraOptions:i.extraOptions||{}}}function o(t){var e=this[t];e&&(e.remove(),delete this[t])}function r(){c.call(this),delete this._adUnit}function s(){c.call(this),d.call(this)}function c(){o.call(this,"_frame"),a.call(this)}function a(){this._onLoad&&(window.removeEventListener("message",this._onLoad),delete this._onLoad)}function d(){this._adUnit&&(this._adUnit.stopAd(),delete this._adUnit)}function u(){if(this._destroyed)throw new Error("VPAIDHTML5Client already destroyed!")}function p(){return window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")}var l=t("./utils"),f=l.unique("vpaidIframe"),h=t("./VPAIDAdUnit"),y='<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"></head><body style="margin:0;padding:0"><div class="ad-element"></div><script type="text/javascript" src="{{iframeURL_JS}}"><\/script><script type="text/javascript">window.parent.postMessage(\'{"event": "ready", "id": "{{iframeID}}"}\', \'{{origin}}\');<\/script></body></html>',A="AdStopped";n.prototype.destroy=function(){this._destroyed||(this._destroyed=!0,s.call(this))},n.prototype.isDestroyed=function(){return this._destroyed},n.prototype.loadAdUnit=function(t,e){if(!this._onLoad){u.call(this),s.call(this);var i=this,n=l.createIframeWithContent(this._frameContainer,this._templateConfig.template,l.extend({iframeURL_JS:t,iframeID:this.getID(),origin:p()},this._templateConfig.extraOptions));this._frame=n,this._onLoad=l.callbackTimeout(this._vpaidOptions.timeout,function(t){if(t.origin===p()&&JSON.parse(t.data).id===i.getID()){var n,o,s;if(i._frame.contentWindow?(s=i._frame.contentWindow.getVPAIDAd,o=l.validate("function"==typeof s,"the ad didn't return a function to create an ad")):o="the iframe is not anymore in the DOM tree",!o){var c=i._frame.contentWindow.document.querySelector(".ad-element");(n=new h(s(),c,i._videoEl,i._frame)).subscribe(A,r.bind(i)),o=l.validate(n.isValidVPAIDAd(),"the add is not fully complaint with VPAID specification")}return i._adUnit=n,a.call(i),e(o,o?null:n),!0}}.bind(this),function(){e("timeout",null)}.bind(this)),window.addEventListener("message",this._onLoad)}},n.prototype.unloadAdUnit=function(){s.call(this)},n.prototype.getID=function(){return this._id},e.exports=n,window.VPAIDHTML5Client=n},{"./VPAIDAdUnit":2,"./utils":5}],4:[function(t,e,i){"use strict";function n(){this._subscribers={}}n.prototype.subscribe=function(t,e,i){this.isHandlerAttached(t,e)||this.get(e).push({handler:t,context:i,eventName:e})},n.prototype.unsubscribe=function(t,e){this._subscribers[e]=this.get(e).filter(function(e){return t!==e.handler})},n.prototype.unsubscribeAll=function(){this._subscribers={}},n.prototype.trigger=function(t,e){var i=this;this.get(t).concat(this.get("*")).forEach(function(t){setTimeout(function(){i.isHandlerAttached(t.handler,t.eventName)&&t.handler.call(t.context,e)},0)})},n.prototype.triggerSync=function(t,e){this.get(t).concat(this.get("*")).forEach(function(t){t.handler.call(t.context,e)})},n.prototype.get=function(t){return this._subscribers[t]||(this._subscribers[t]=[]),this._subscribers[t]},n.prototype.isHandlerAttached=function(t,e){return this.get(e).some(function(e){return t===e.handler})},e.exports=n},{}],5:[function(t,e,i){"use strict";function n(){}function o(t,e,i){var n=document.createElement("iframe");return n.src=e||"about:blank",n.marginWidth="0",n.marginHeight="0",n.frameBorder="0",n.width="100%",n.height="100%",r(n),i&&(n.style.zIndex=i),n.setAttribute("SCROLLING","NO"),t.innerHTML="",t.appendChild(n),n}function r(t){t&&(t.style.position="absolute",t.style.left="0",t.style.top="0",t.style.margin="0px",t.style.padding="0px",t.style.border="none",t.style.width="100%",t.style.height="100%")}function s(t,e){return Object.keys(e).forEach(function(i){var n="object"==typeof n?JSON.stringify(e[i]):e[i];t=t.replace(new RegExp("{{"+i+"}}","g"),n)}),t}function c(t,e){var i=t.contentWindow&&t.contentWindow.document;return!!i&&(i.write(e),!0)}e.exports={noop:n,validate:function(t,e){return t?null:new Error(e)},callbackTimeout:function(t,e,i){var o;return o=setTimeout(function(){e=n,i()},t),function(){e.apply(this,arguments)&&clearTimeout(o)}},createElementInEl:function(t,e,i){var n=document.createElement(e);return i&&(n.id=i),t.appendChild(n),n},createIframeWithContent:function(t,e,i){var n=o(t,null,i.zIndex);if(c(n,s(e,i)))return n},createIframe:o,setFullSizeStyle:r,simpleTemplate:s,setIframeContent:c,extend:function(t,e){return Object.keys(e).forEach(function(i){t[i]=e[i]}),t},unique:function(t){var e=-1;return function(){return t+"_"+ ++e}}}},{}]},{},[3]);
function getElement(e,t){return t?t.querySelector(e):document.querySelector(e)}function createElement(e,t,i,n,s){var o=document.createElement(t);if(o.className=i,o.identify=e,n||(n={}),s)for(l=0;l<s.length;l++)o.setAttribute(s[l].name,s[l].value);if(n.innerHTML&&(o.innerHTML=n.innerHTML),n.childrens)for(var r,a,l=0;l<n.childrens.length;l++)a=createElement((r=n.childrens[l]).identify,r.tag,r.className,r.options,r.properties),o.appendChild(a),o[r.identify]=a;return o}function removeElement(e){try{e.parentNode.removeChild(e)}catch(e){}}function isMobile(){var e={},t=/iPhone/i,i=/iPod/i,n=/iPad/i,s=/(?=.*\bAndroid\b)(?=.*\bMobile\b)/i,o=/Android/i,r=/(?=.*\bAndroid\b)(?=.*\bSD4930UR\b)/i,a=/(?=.*\bAndroid\b)(?=.*\b(?:KFOT|KFTT|KFJWI|KFJWA|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|KFARWI|KFASWI|KFSAWI|KFSAWA)\b)/i,l=/IEMobile/i,c=/(?=.*\bWindows\b)(?=.*\bARM\b)/i,p=/BlackBerry/i,d=/BB10/i,h=/Opera Mini/i,u=/(CriOS|Chrome)(?=.*\bMobile\b)/i,m=/SamsungBrowser/i,v=/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i,y=/UC.*Browser|UCWEB/i,b=new RegExp("(?:Nexus 7|BNTV250|Kindle Fire|Silk|GT-P1000)","i"),f=function(e,t){return e.test(t)},k=navigator.userAgent,g=k.split("[FBAN");return void 0!==g[1]&&(k=g[0]),e.apple={phone:f(t,k),ipod:f(i,k),tablet:!f(t,k)&&f(n,k),device:f(t,k)||f(i,k)||f(n,k)},e.amazon={phone:f(r,k),tablet:!f(r,k)&&f(a,k),device:f(r,k)||f(a,k)},e.android={phone:f(r,k)||f(s,k),tablet:!f(r,k)&&!f(s,k)&&(f(a,k)||f(o,k)),device:f(r,k)||f(a,k)||f(s,k)||f(o,k)},e.windows={phone:f(l,k),tablet:f(c,k),device:f(l,k)||f(c,k)},e.other={blackberry:f(p,k),blackberry10:f(d,k),opera:f(h,k),firefox:f(v,k),chrome:f(u,k),samsung:f(m,k),uc:f(y,k),device:f(p,k)||f(d,k)||f(h,k)||f(v,k)||f(u,k)},e.seven_inch=f(b,k),e.any=e.apple.device||e.android.device||e.windows.device||e.other.device||e.seven_inch,e.phone=e.apple.phone||e.android.phone||e.windows.phone,e.tablet=e.apple.tablet||e.android.tablet||e.windows.tablet,e}function fetchVAST(e,t){var i={};if(e&&(i.adData=e,i.extensions=e.ads[0].extensions,e.ads.length)){if(e.ads[0].creatives.length>0)for(var n=0;n<e.ads.length;n++)for(var s=e.ads[n],o=0;o<s.creatives.length;o++){var r=s.creatives[o];if("linear"==r.type){i.duration=r.duration;var a="",l="";if(r.mediaFiles.length)for(var c=0;c<r.mediaFiles.length;c++){if(a=r.mediaFiles[c].fileURL.trim(),l=r.mediaFiles[c].mimeType,i.fileURL=a,i.mimeType=l,i.tracker=new DMVAST.tracker(s,r),"video/mp4"==l)return i;"application/javascript"==l&&(i.vpaid=!0)}}}}return i}var ismobile=isMobile(),VAST=DMVAST.client,bsplayer=function(e){this.name="BSPlayer",this.vast={},e||(e={}),e.wrapper&&(this.wrapper=getElement(e.wrapper),this.video=getElement("video",this.wrapper)),this.wrapper?(this.width=this.wrapper.offsetWidth,this.height=this.wrapper.offsetHeight,e.prerolls&&(this.prerolls=e.prerolls,this.inside=!0),e.midrolls&&(this.midrolls=e.midrolls),e.postrolls&&(this.postrolls=e.postrolls),e.autoplay&&(this.autoplay=!0),e.mute&&(this.mute=!0),this.options=e,this.initallize()):console.log("Please set wrapper!")};bsplayer.prototype.initallize=function(){var e=this;this.element=createElement("JLight","div","bsplayer",{childrens:[{identify:"video",tag:"video",className:"bsplayer-video",options:{},properties:[{name:"preload",value:"auto"},{name:"playsinline",value:""},{name:"webkit-playsinline",value:""}]},{identify:"poster",tag:"img",className:"bsplayer-poster bshidden",options:{}},{identify:"blocker",tag:"a",className:"bsplayer-blocker bshidden",options:{},properties:[{name:"target",value:"_blank"},{name:"href",value:""}]},{identify:"container",tag:"div",className:"bsplayer-container bshidden",options:{childrens:[{identify:"vpaid",tag:"div",className:"bsplayer-vpaid bshidden"}]}},{identify:"progress",tag:"div",className:"bsplayer-progress",options:{childrens:[{identify:"loaded",tag:"div",className:"bsplayer-loaded"}]}},{identify:"controls",tag:"div",className:"bsplayer-controls",options:{childrens:[{identify:"play",tag:"div",className:"bsplayer-play bsbutton",options:{childrens:[{identify:"icon",tag:"i",className:"bsicon-play"}]}},{identify:"mute",tag:"div",className:"bsplayer-mute bsbutton",options:{childrens:[{identify:"icon",tag:"i",className:"bsicon-volume-on"}]}},{identify:"skip",tag:"div",className:"bsplayer-skip bsbutton bshidden",options:{innerHTML:"Skip"}}]}}]}),this.contextMenu=createElement("context","div","bsplayer-context",{innerHTML:'<a href="http://blueseed.tv" target="_blank">JLight Player</a>'}),document.body.appendChild(this.contextMenu),this.events={},this.wrapper.appendChild(this.element),this.options.position=0,this.prerolls.length&&this.getVAST(this.prerolls[0].vastURL,this.options),this.element.oncontextmenu=function(t){t.preventDefault(),e.displayContext(t)},this.element.controls.play.onclick=function(){e.element.dispatchEvent(e.events.onPlayClick),e.paused?(e.reload&&(e.reload=!1,e.element.video.currentTime=0),e.play(),e.canvas&&e.offFakePlay(!0)):e.pause()},this.element.controls.mute.onclick=function(){e.element.dispatchEvent(e.events.onVolumeClick),e.canvas&&(e.offFakePlay(!0),e.muted=!0),e.muted?e.volume(.2):e.volume(0)},this.element.controls.skip.onclick=function(){e.element.dispatchEvent(e.events.onSkipClick),e.skip()},this.contextMenu.oncontextmenu=function(e){e.preventDefault()},setTimeout(function(){e.events.onInit=new Event("bsplayerOnInit"),document.dispatchEvent(e.events.onInit)},50),this.createEvents(),window.addEventListener("resize",function(){e.width!=e.wrapper.offsetWidth&&(e.width=e.wrapper.offsetWidth,e.height=e.wrapper.offsetHeight,e.resize())}),document.addEventListener("click",function(t){try{if(3==t.which)return}catch(e){}e.contextMenu.style.display="none"})},bsplayer.prototype.getElement=function(e,t){return getElement(e,t)},bsplayer.prototype.createElement=function(e,t,i,n,s){return createElement(e,t,i,n,s)},bsplayer.prototype.removeElement=function(e){removeElement(e)},bsplayer.prototype.createEvents=function(){this.events.onInit=new Event("bsplayerOnInit"),this.events.onLoad=new Event("bsplayerOnLoad"),this.events.onAdResponse=new Event("bsplayerOnAdResponse"),this.events.onStart=new Event("bsplayerOnStart"),this.events.onError=new Event("bsplayerOnError"),this.events.onPlayClick=new Event("bsplayerOnPlayClick"),this.events.onSkipClick=new Event("bsplayerOnSkipClick"),this.events.onPaused=new Event("bsplayerOnPaused"),this.events.onPlaying=new Event("bsplayerOnPlaying"),this.events.onFirstQuartile=new Event("bsplayerOnFirstQuartile"),this.events.onMidpoint=new Event("bsplayerOnMidpoint"),this.events.onThirdQuartile=new Event("bsplayerOnThirdQuartile"),this.events.onClick=new Event("bsplayerOnClick"),this.events.onSkip=new Event("bsplayerOnSkip"),this.events.onComplete=new Event("bsplayerOnComplete"),this.events.onMuted=new Event("bsplayerOnMuted"),this.events.onVolumeClick=new Event("bsplayerOnVolumeClick"),this.events.onVolumeChange=new Event("bsplayerOnVolumeChange"),this.events.onStop=new Event("bsplayerOnStop"),this.events.onDestroy=new Event("bsplayerOnDestroy")},bsplayer.prototype.on=function(e,t){this.element.addEventListener(e,t)},bsplayer.prototype.off=function(e,t){this.element.removeEventListener(e,t,!1)},bsplayer.prototype.displayContext=function(e){var t=e.pageY,i=e.pageX,n=this.contextMenu.clientHeight;e.pageY+n>this.element.clientHeight+this.element.getBoundingClientRect().top&&(t=e.pageY-this.contextMenu.clientHeight),e.pageX+this.contextMenu.clientWidth>this.element.clientWidth+this.element.getBoundingClientRect().left&&(i=e.pageX-this.contextMenu.clientWidth),this.contextMenu.setAttribute("style","top: "+t+"px; left: "+i+"px; display: block;")},bsplayer.prototype.fakePlay=function(){var e=this;if(!e.started&&!e.completed){e.paused=!0;var t=e.element.video;e.canvas=!0;var i=0,n=1e3;setTimeout(function(){n=20*(t.duration-t.currentTime)},1e3),console.log(n),e.intervalPlay=setInterval(function(){e.started||e.stopped||i>n||t.currentTime>=t.duration?e.offFakePlay():(e.element.video.currentTime=e.element.video.currentTime+.1,i++)},100)}},bsplayer.prototype.offFakePlay=function(e){clearInterval(this.intervalPlay),e&&(this.play(),this.volume(.2)),this.canvas=!1},bsplayer.prototype.getVAST=function(e,t){if(console.log("get vast: "+e),t||!this.inside){var i=this;VAST.get(e,function(e){console.log(e),i.fetchVAST(e,t)})}},bsplayer.prototype.fetchVAST=function(e,t){var i=fetchVAST(e,t);if(i.adData){if(this.adData=i.adData,this.extensions=i.extensions,this.element.dispatchEvent(this.events.onAdResponse),this.duration=i.duration,this.tracker=i.tracker,"video/mp4"==i.mimeType)return void this.playVAST(i.fileURL,t);if(i.vpaid)return void this.playVPAID(i.fileURL,t)}this.getBackup||(this.getBackup=!0,""==this.prerolls[t.position].vastBackup)?this.onComplete():this.getVAST(this.prerolls[t.position].vastBackup,t)},bsplayer.prototype.playVAST=function(e,t){console.log("play VAST"),this.type=0;var i=this,n=this.element.video,s="bsicon-pause";this.options.skip=this.prerolls[t.position].skip,i.element.container.classList.add("bshidden"),n.src=e,n.load();try{t.poster?(this.element.poster.src=t.poster,this.element.poster.classList.remove("bshidden")):n.currentTime=.1,this.video.pause()}catch(e){}if(this.autoplay?(n.play(),ismobile.any&&this.fakePlay()):this.paused=!0,this.mute&&this.volume(0),i.tracker.clickThroughURLTemplate){var o=DMVAST.util.resolveURLTemplates([i.tracker.clickThroughURLTemplate],{CACHEBUSTER:Math.round(1e10*Math.random()),CONTENTPLAYHEAD:i.tracker.progressFormated()})[0];this.element.blocker.classList.remove("bshidden"),this.element.blocker.href=o,this.element.blocker.onclick=function(){i.tracker.click(),i.element.dispatchEvent(i.events.onClick)}}n.addEventListener("loadstart",function(){i.completed||i.options.notrack||i.tracker.load(),i.started||(s="bsicon-play"),i.tracker.assetDuration>n.duration&&(i.tracker.assetDuration=n.duration),i.element.controls.play.icon.className=s,i.element.dispatchEvent(i.events.onLoad),console.log("player.tracker.quartiles"),console.log(i.tracker.quartiles)}),n.addEventListener("pause",function(){i.paused=!0,i.element.controls.play.icon.className="bsicon-play",i.element.dispatchEvent(i.events.onPaused)}),n.addEventListener("play",function(){i.started=!0,i.paused=!1,i.element.poster.classList.add("bshidden"),i.element.controls.play.icon.className="bsicon-pause",i.element.dispatchEvent(i.events.onPlaying)}),n.addEventListener("timeupdate",function(){i.completed||(i.tracker.assetDuration>n.duration&&(i.tracker.assetDuration=n.duration),i.currentTime<i.tracker.quartiles.firstQuartile&&this.currentTime>i.tracker.quartiles.firstQuartile?i.tracker.setProgress(i.tracker.quartiles.firstQuartile):i.currentTime<i.tracker.quartiles.midpoint&&this.currentTime>i.tracker.quartiles.midpoint?i.tracker.setProgress(i.tracker.quartiles.midpoint):i.currentTime<i.tracker.quartiles.thirdQuartile&&this.currentTime>i.tracker.quartiles.thirdQuartile&&i.tracker.setProgress(i.tracker.quartiles.thirdQuartile),i.currentTime=this.currentTime),i.element.poster.classList.add("bshidden"),i.element.controls.skip.classList.remove("bshidden");var e=Math.ceil(i.options.skip-this.currentTime);e>0?(i.element.controls.skip.innerHTML=e+"s",i.element.controls.skip.classList.add("disabled")):(i.element.controls.skip.innerHTML="Skip",i.element.controls.skip.classList.remove("disabled"),i.skippable=!0),i.element.progress.loaded.style.width=this.currentTime/this.duration*100+"%"}),n.addEventListener("ended",function(){i.completed||i.tracker.complete(),i.stopped||i.onComplete()}),this.tracker.on("firstQuartile",function(){i.element.dispatchEvent(i.events.onFirstQuartile)}),this.tracker.on("midpoint",function(){i.element.dispatchEvent(i.events.onMidpoint)}),this.tracker.on("thirdQuartile",function(){i.element.dispatchEvent(i.events.onThirdQuartile)})},bsplayer.prototype.playVPAID=function(e,t){this.type=1;var i=this,n=this.element.video,s=this.element.container,o=new VPAIDHTML5Client(s,n,{});s.classList.remove("bshidden"),o.loadAdUnit(e,function(e,n){function s(){var e=i.prerolls[t.position].skip;i.duration=n._creative.getAdDuration(),setTimeout(function(){i.duration<n._creative.getAdRemainingTime()&&(i.duration=n._creative.getAdRemainingTime())},900),i.interval=setInterval(function(){var t=n._creative.getAdRemainingTime(),s=i.duration-t,o=Math.ceil(e-s);o>0?(i.element.controls.skip.innerHTML=o+"s",i.element.controls.skip.classList.add("disabled")):(i.element.controls.skip.innerHTML="Skip",i.element.controls.skip.classList.remove("disabled"),i.skippable=!0),i.element.progress.loaded.style.width=s/i.duration*100+"%",t<=0&&clearInterval(i.interval)},1e3)}if(e)return i.onComplete(),void i.element.dispatchEvent(i.events.onError);try{i.video.pause()}catch(e){}i.adUnit=n,n.subscribe("AdLoaded",function(){i.autoplay?(n.startAd(),ismobile.any&&(i.volume(0),i.fakePlay())):i.paused=!0,i.options.notrack||i.tracker.load(),i.element.dispatchEvent(i.events.onLoad),s()}),n.subscribe("AdStarted",function(){i.started=!0,i.tracker.setProgress(.1),i.element.controls.play.icon.className="bsicon-pause",i.element.controls.skip.classList.remove("bshidden"),i.element.dispatchEvent(i.events.onStart)}),n.subscribe("AdPaused",function(){i.paused=!0,i.element.controls.play.icon.className="bsicon-play",i.element.dispatchEvent(i.events.onPaused)}),n.subscribe("AdPlaying",function(){i.paused=!1,i.element.controls.play.icon.className="bsicon-pause",i.element.dispatchEvent(i.events.onPlaying)}),n.subscribe("AdVideoFirstQuartile",function(){i.tracker.setProgress(i.tracker.quartiles.firstQuartile),i.element.dispatchEvent(i.events.onFirstQuartile)}),n.subscribe("AdVideoMidpoint",function(){i.tracker.setProgress(i.tracker.quartiles.midpoint),i.element.dispatchEvent(i.events.onMidpoint)}),n.subscribe("AdVideoThirdQuartile",function(){i.tracker.setProgress(i.tracker.quartiles.thirdQuartile),i.element.dispatchEvent(i.events.onThirdQuartile)}),n.subscribe("AdVideoComplete",function(){i.tracker.complete(),i.completed||i.onComplete()}),n.subscribe("AdClickThru",function(){i.tracker.click(),i.element.dispatchEvent(i.events.onClick)}),n.handshakeVersion("2.0",function(e,t){n.initAd(i.width,i.height,"normal",-1,{AdParameters:i.tracker.creative.adParameters},{})})})},bsplayer.prototype.onComplete=function(){if(this.completed=!0,this.options.htmlOnComplete)try{return this.element.appendChild(this.options.htmlOnComplete),this.element.video.classList.add("bshidden"),this.element.blocker.classList.add("bshidden"),this.element.progress.classList.add("bshidden"),this.element.controls.classList.add("bshidden"),void(this.options.htmlOnComplete.onclick=this.click({open:!0}))}catch(e){}this.stopped||(this.element.dispatchEvent(this.events.onComplete),this.destroy())},bsplayer.prototype.play=function(){if(this.type)return this.started?void this.adUnit.resumeAd():(this.volume(0),this.adUnit.startAd(),void(this.paused=!1));this.element.video.play()},bsplayer.prototype.pause=function(){if(this.type)try{this.adUnit.pauseAd()}catch(e){}else this.element.video.pause()},bsplayer.prototype.skip=function(){this.skippable&&(this.element.dispatchEvent(this.events.onSkip),this.type&&this.adUnit.skipAd(),this.skipped||(this.skipped=!0,this.tracker.skip()),this.destroy())},bsplayer.prototype.stop=function(){this.stopped=!0,this.type?this.adUnit.stopAd():this.element.video.currentTime=this.element.video.duration,this.destroy(),this.element.dispatchEvent(this.events.onStop)},bsplayer.prototype.click=function(e){if(e||(e={}),this.tracker.clickThroughURLTemplate){var t=DMVAST.util.resolveURLTemplates([this.tracker.clickThroughURLTemplate],{CACHEBUSTER:Math.round(1e10*Math.random()),CONTENTPLAYHEAD:this.tracker.progressFormated()})[0];if(this.tracker.click(),this.element.dispatchEvent(this.events.onClick),e.open){var i=document.createElement("a");if(i.href=t,i.target="_blank",document.createEvent){var n=document.createEvent("MouseEvents");n.initEvent("click",!0,!0),i.dispatchEvent(n)}else window.open(t)}}},bsplayer.prototype.resize=function(){console.log("resize"),this.type&&(console.log("resizeAd"),this.adUnit.resizeAd(this.width,this.height,"normal",function(){console.log("fuck off")}))},bsplayer.prototype.destroy=function(){var e=!0;if(clearInterval(this.interval),this.options.reuse||this.options.reload)return this.options.poster?this.element.poster.classList.remove("bshidden"):this.element.video.currentTime=this.element.video.duration-.2,this.element.video.pause(),this.element.controls.play.icon.className="bsicon-reload",this.reload=!0,!1;if(this.type)try{this.adUnit._destroy()}catch(t){e=!1,console.log("Can't not destroy player!")}else this.element.video.pause(),this.element.video.src="";return e&&removeElement(this.element),this.element.dispatchEvent(this.events.onDestroy),e},bsplayer.prototype.volume=function(e){if(this.type)try{this.adUnit.setAdVolume(e),this.element.video.muted=!e}catch(e){}else this.element.video.volume=e,this.element.video.muted=!e;return e?(this.muted=!1,this.element.controls.mute.icon.className="bsicon-volume-on"):(this.muted=!0,this.element.controls.mute.icon.className="bsicon-volume-off"),this.element.dispatchEvent(this.events.onVolumeChange),e};